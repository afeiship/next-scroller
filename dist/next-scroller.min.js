!function(e){var _=window.nx||require("next-js-core2"),o=_.Animate||require("next-animate"),t=function(e){return Math.pow(e-1,3)+1},l=function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)},i=_.declare("nx.Scroller",{methods:{init:function(e,o){this.__callback=e,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,scrollingComplete:_.noop,penetrationDeceleration:.03,penetrationAcceleration:.08},_.mix(this.options,o)},__isSingleTouch:!1,__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(e,_,o,t){var l=this;e===+e&&(l.__clientWidth=e),_===+_&&(l.__clientHeight=_),o===+o&&(l.__contentWidth=o),t===+t&&(l.__contentHeight=t),l.__computeScrollMax(),l.scrollTo(l.__scrollLeft,l.__scrollTop,!0)},setPosition:function(e,_){var o=this;o.__clientLeft=e||0,o.__clientTop=_||0},setSnapSize:function(e,_){var o=this;o.__snapWidth=e,o.__snapHeight=_},activatePullToRefresh:function(e,_,o,t){var l=this;l.__refreshHeight=e,l.__refreshActivate=_,l.__refreshDeactivate=o,l.__refreshStart=t},triggerPullToRefresh:function(){this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()},finishPullToRefresh:function(){var e=this;e.__refreshActive=!1,e.__refreshDeactivate&&e.__refreshDeactivate(),e.scrollTo(e.__scrollLeft,e.__scrollTop,!0)},getValues:function(){var e=this;return{left:e.__scrollLeft,top:e.__scrollTop,zoom:e.__zoomLevel}},getScrollMax:function(){var e=this;return{left:e.__maxScrollLeft,top:e.__maxScrollTop}},zoomTo:function(e,_,t,l,i){var n=this;if(!n.options.zooming)throw new Error("Zooming is not enabled!");i&&(n.__zoomComplete=i),n.__isDecelerating&&(o.stop(n.__isDecelerating),n.__isDecelerating=!1);var r=n.__zoomLevel;null==t&&(t=n.__clientWidth/2),null==l&&(l=n.__clientHeight/2),e=Math.max(Math.min(e,n.options.maxZoom),n.options.minZoom),n.__computeScrollMax(e);var a=(t+n.__scrollLeft)*e/r-t,c=(l+n.__scrollTop)*e/r-l;a>n.__maxScrollLeft?a=n.__maxScrollLeft:a<0&&(a=0),c>n.__maxScrollTop?c=n.__maxScrollTop:c<0&&(c=0),n.__publish(a,c,e,_)},zoomBy:function(e,_,o,t,l){var i=this;i.zoomTo(i.__zoomLevel*e,_,o,t,l)},scrollTo:function(e,_,t,l){var i=this;if(i.__isDecelerating&&(o.stop(i.__isDecelerating),i.__isDecelerating=!1),null!=l&&l!==i.__zoomLevel){if(!i.options.zooming)throw new Error("Zooming is not enabled!");e*=l,_*=l,i.__computeScrollMax(l)}else l=i.__zoomLevel;i.options.scrollingX?i.options.paging?e=Math.round(e/i.__clientWidth)*i.__clientWidth:i.options.snapping&&(e=Math.round(e/i.__snapWidth)*i.__snapWidth):e=i.__scrollLeft,i.options.scrollingY?i.options.paging?_=Math.round(_/i.__clientHeight)*i.__clientHeight:i.options.snapping&&(_=Math.round(_/i.__snapHeight)*i.__snapHeight):_=i.__scrollTop,e=Math.max(Math.min(i.__maxScrollLeft,e),0),_=Math.max(Math.min(i.__maxScrollTop,_),0),e===i.__scrollLeft&&_===i.__scrollTop&&(t=!1),i.__isTracking||i.__publish(e,_,l,t)},scrollBy:function(e,_,o){var t=this,l=t.__isAnimating?t.__scheduledLeft:t.__scrollLeft,i=t.__isAnimating?t.__scheduledTop:t.__scrollTop;t.scrollTo(l+(e||0),i+(_||0),o)},doMouseZoom:function(e,_,o,t){var l=this,i=e>0?.97:1.03;return l.zoomTo(l.__zoomLevel*i,!1,o-l.__clientLeft,t-l.__clientTop)},doTouchStart:function(e,_){if(null==e.length)throw new Error("Invalid touch list: "+e);if(_ instanceof Date&&(_=_.valueOf()),"number"!=typeof _)throw new Error("Invalid timestamp value: "+_);var t=this;t.__interruptedAnimation=!0,t.__isDecelerating&&(o.stop(t.__isDecelerating),t.__isDecelerating=!1,t.__interruptedAnimation=!0),t.__isAnimating&&(o.stop(t.__isAnimating),t.__isAnimating=!1,t.__interruptedAnimation=!0);var l,i,n=1===e.length;n?(l=e[0].pageX,i=e[0].pageY):(l=Math.abs(e[0].pageX+e[1].pageX)/2,i=Math.abs(e[0].pageY+e[1].pageY)/2),t.__initialTouchLeft=l,t.__initialTouchTop=i,t.__zoomLevelStart=t.__zoomLevel,t.__lastTouchLeft=l,t.__lastTouchTop=i,t.__lastTouchMove=_,t.__lastScale=1,t.__enableScrollX=!n&&t.options.scrollingX,t.__enableScrollY=!n&&t.options.scrollingY,t.__isTracking=!0,t.__didDecelerationComplete=!1,t.__isDragging=!n,t.__isSingleTouch=n,t.__positions=[]},doTouchMove:function(e,_,o){if(null==e.length)throw new Error("Invalid touch list: "+e);if(_ instanceof Date&&(_=_.valueOf()),"number"!=typeof _)throw new Error("Invalid timestamp value: "+_);var t=this;if(t.__isTracking){var l,i;2===e.length?(l=Math.abs(e[0].pageX+e[1].pageX)/2,i=Math.abs(e[0].pageY+e[1].pageY)/2):(l=e[0].pageX,i=e[0].pageY);var n=t.__positions;if(t.__isDragging){var r=l-t.__lastTouchLeft,a=i-t.__lastTouchTop,c=t.__scrollLeft,s=t.__scrollTop,p=t.__zoomLevel;if(null!=o&&t.options.zooming){var h=p;if(p=p/t.__lastScale*o,p=Math.max(Math.min(p,t.options.maxZoom),t.options.minZoom),h!==p){var m=l-t.__clientLeft,f=i-t.__clientTop;c=(m+c)*p/h-m,s=(f+s)*p/h-f,t.__computeScrollMax(p)}}if(t.__enableScrollX){c-=r*this.options.speedMultiplier;var u=t.__maxScrollLeft;(c>u||c<0)&&(t.options.bouncing?c+=r/2*this.options.speedMultiplier:c=c>u?u:0)}if(t.__enableScrollY){s-=a*this.options.speedMultiplier;var g=t.__maxScrollTop;(s>g||s<0)&&(t.options.bouncing?(s+=a/2*this.options.speedMultiplier,t.__enableScrollX||null==t.__refreshHeight||(!t.__refreshActive&&s<=-t.__refreshHeight?(t.__refreshActive=!0,t.__refreshActivate&&t.__refreshActivate()):t.__refreshActive&&s>-t.__refreshHeight&&(t.__refreshActive=!1,t.__refreshDeactivate&&t.__refreshDeactivate()))):s=s>g?g:0)}n.length>60&&n.splice(0,30),n.push(c,s,_),t.__publish(c,s,p)}else{var v=t.options.locking?3:0,d=Math.abs(l-t.__initialTouchLeft),T=Math.abs(i-t.__initialTouchTop);t.__enableScrollX=t.options.scrollingX&&d>=v,t.__enableScrollY=t.options.scrollingY&&T>=v,n.push(t.__scrollLeft,t.__scrollTop,_),t.__isDragging=(t.__enableScrollX||t.__enableScrollY)&&(d>=5||T>=5),t.__isDragging&&(t.__interruptedAnimation=!1)}t.__lastTouchLeft=l,t.__lastTouchTop=i,t.__lastTouchMove=_,t.__lastScale=o}},doTouchEnd:function(e){if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var _=this;if(_.__isTracking){if(_.__isTracking=!1,_.__isDragging)if(_.__isDragging=!1,_.__isSingleTouch&&_.options.animating&&e-_.__lastTouchMove<=100){for(var o=_.__positions,t=o.length-1,l=t,i=t;i>0&&o[i]>_.__lastTouchMove-100;i-=3)l=i;if(l!==t){var n=o[t]-o[l],r=_.__scrollLeft-o[l-2],a=_.__scrollTop-o[l-1];_.__decelerationVelocityX=r/n*(1e3/60),_.__decelerationVelocityY=a/n*(1e3/60);var c=_.options.paging||_.options.snapping?4:1;Math.abs(_.__decelerationVelocityX)>c||Math.abs(_.__decelerationVelocityY)>c?_.__refreshActive||_.__startDeceleration(e):_.options.scrollingComplete()}else _.options.scrollingComplete()}else e-_.__lastTouchMove>100&&_.options.scrollingComplete();_.__isDecelerating||(_.__refreshActive&&_.__refreshStart?(_.__publish(_.__scrollLeft,-_.__refreshHeight,_.__zoomLevel,!0),_.__refreshStart&&_.__refreshStart()):((_.__interruptedAnimation||_.__isDragging)&&_.options.scrollingComplete(),_.scrollTo(_.__scrollLeft,_.__scrollTop,!0,_.__zoomLevel),_.__refreshActive&&(_.__refreshActive=!1,_.__refreshDeactivate&&_.__refreshDeactivate()))),_.__positions.length=0}},__publish:function(e,_,i,n){var r=this,a=r.__isAnimating;if(a&&(o.stop(a),r.__isAnimating=!1),n&&r.options.animating){r.__scheduledLeft=e,r.__scheduledTop=_,r.__scheduledZoom=i;var c=r.__scrollLeft,s=r.__scrollTop,p=r.__zoomLevel,h=e-c,m=_-s,f=i-p,u=function(e,_,o){o&&(r.__scrollLeft=c+h*e,r.__scrollTop=s+m*e,r.__zoomLevel=p+f*e,r.__callback&&r.__callback(r.__scrollLeft,r.__scrollTop,r.__zoomLevel))},g=function(e){return r.__isAnimating===e},v=function(e,_,o){_===r.__isAnimating&&(r.__isAnimating=!1),(r.__didDecelerationComplete||o)&&r.options.scrollingComplete(),r.options.zooming&&(r.__computeScrollMax(),r.__zoomComplete&&(r.__zoomComplete(),r.__zoomComplete=null))};r.__isAnimating=o.start(u,g,v,r.options.animationDuration,a?t:l)}else r.__scheduledLeft=r.__scrollLeft=e,r.__scheduledTop=r.__scrollTop=_,r.__scheduledZoom=r.__zoomLevel=i,r.__callback&&r.__callback(e,_,i),r.options.zooming&&(r.__computeScrollMax(),r.__zoomComplete&&(r.__zoomComplete(),r.__zoomComplete=null))},__computeScrollMax:function(e){var _=this;null==e&&(e=_.__zoomLevel),_.__maxScrollLeft=Math.max(_.__contentWidth*e-_.__clientWidth,0),_.__maxScrollTop=Math.max(_.__contentHeight*e-_.__clientHeight,0)},__startDeceleration:function(e){var _=this;if(_.options.paging){var t=Math.max(Math.min(_.__scrollLeft,_.__maxScrollLeft),0),l=Math.max(Math.min(_.__scrollTop,_.__maxScrollTop),0),i=_.__clientWidth,n=_.__clientHeight;_.__minDecelerationScrollLeft=Math.floor(t/i)*i,_.__minDecelerationScrollTop=Math.floor(l/n)*n,_.__maxDecelerationScrollLeft=Math.ceil(t/i)*i,_.__maxDecelerationScrollTop=Math.ceil(l/n)*n}else _.__minDecelerationScrollLeft=0,_.__minDecelerationScrollTop=0,_.__maxDecelerationScrollLeft=_.__maxScrollLeft,_.__maxDecelerationScrollTop=_.__maxScrollTop;var r=function(e,o,t){_.__stepThroughDeceleration(t)},a=_.options.snapping?4:.001,c=function(){var e=Math.abs(_.__decelerationVelocityX)>=a||Math.abs(_.__decelerationVelocityY)>=a;return e||(_.__didDecelerationComplete=!0),e},s=function(e,o,t){_.__isDecelerating=!1,_.__didDecelerationComplete&&_.options.scrollingComplete(),_.scrollTo(_.__scrollLeft,_.__scrollTop,_.options.snapping)};_.__isDecelerating=o.start(r,c,s)},__stepThroughDeceleration:function(e){var _=this,o=_.__scrollLeft+_.__decelerationVelocityX,t=_.__scrollTop+_.__decelerationVelocityY;if(!_.options.bouncing){var l=Math.max(Math.min(_.__maxDecelerationScrollLeft,o),_.__minDecelerationScrollLeft);l!==o&&(o=l,_.__decelerationVelocityX=0);var i=Math.max(Math.min(_.__maxDecelerationScrollTop,t),_.__minDecelerationScrollTop);i!==t&&(t=i,_.__decelerationVelocityY=0)}if(e?_.__publish(o,t,_.__zoomLevel):(_.__scrollLeft=o,_.__scrollTop=t),!_.options.paging){_.__decelerationVelocityX*=.95,_.__decelerationVelocityY*=.95}if(_.options.bouncing){var n=0,r=0,a=_.options.penetrationDeceleration,c=_.options.penetrationAcceleration;o<_.__minDecelerationScrollLeft?n=_.__minDecelerationScrollLeft-o:o>_.__maxDecelerationScrollLeft&&(n=_.__maxDecelerationScrollLeft-o),t<_.__minDecelerationScrollTop?r=_.__minDecelerationScrollTop-t:t>_.__maxDecelerationScrollTop&&(r=_.__maxDecelerationScrollTop-t),0!==n&&(n*_.__decelerationVelocityX<=0?_.__decelerationVelocityX+=n*a:_.__decelerationVelocityX=n*c),0!==r&&(r*_.__decelerationVelocityY<=0?_.__decelerationVelocityY+=r*a:_.__decelerationVelocityY=r*c)}}}});"undefined"!=typeof module&&module.exports&&(module.exports=i)}();